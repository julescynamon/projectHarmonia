const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/index.DNpxeyR_.js","_astro/_commonjsHelpers.CkY8qhWC.js","_astro/preload-helper.Cat91CNq.js"])))=>i.map(i=>d[i]);
import{_ as e}from"./preload-helper.Cat91CNq.js";document.addEventListener("DOMContentLoaded",(function(){const t=document.getElementById("auth-form"),n=document.getElementById("error-message");t&&t.addEventListener("submit",(async function(s){s.preventDefault();const o=new FormData(t),a=t.dataset.type,i=o.get("email")?.toString()||"",r=o.get("password")?.toString()||"",c=o.get("name")?.toString();n&&n.classList.add("hidden");try{const{createClient:t}=await e((async()=>{const{createClient:e}=await import("./index.DNpxeyR_.js");return{createClient:e}}),__vite__mapDeps([0,1,2])),n=t("https://hvthtebjvmutuvzvttdb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh2dGh0ZWJqdm11dHV2enZ0dGRiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzY2OTM5NTgsImV4cCI6MjA1MjI2OTk1OH0.gpI9njtvd6Mu_0wTnwfvtx0bFpUDNexuzwu3hgOGDdY",{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,storage:localStorage}});let s;if("login"===a)s=await n.auth.signInWithPassword({email:i,password:r});else if("register"===a&&(s=await n.auth.signUp({email:i,password:r,options:{data:{name:c}}}),!s.error))return alert("Inscription réussie ! Vous pouvez maintenant vous connecter."),void(window.location.href="/login");if(s.error)throw s.error;const{data:{session:o}}=s;if(!o)throw new Error("Session non établie après authentification.");{const e=o.access_token,t=new Date(1e3*o.expires_at);document.cookie=`sb-access-token=${e}; path=/; expires=${t.toUTCString()}`;const n=JSON.stringify({access_token:o.access_token,refresh_token:o.refresh_token,expires_at:o.expires_at});document.cookie=`supabase.auth.token=${encodeURIComponent(n)}; path=/; expires=${t.toUTCString()}`;try{const e=await fetch("/api/auth/sync-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session:{access_token:o.access_token,refresh_token:o.refresh_token,expires_at:o.expires_at,user:{id:o.user.id,email:o.user.email}}})});await e.json();setTimeout((()=>{const e=new URLSearchParams(window.location.search).get("returnTo");window.location.href=e||"/mon-compte"}),500)}catch(d){const e=new URLSearchParams(window.location.search).get("returnTo");window.location.href=e||"/mon-compte"}}}catch(m){n&&(n.textContent="Invalid login credentials"===m.message?"Email ou mot de passe incorrect":m.message,n.classList.remove("hidden"))}}))}));
